const { getRules } = require("../utils")

const truncate = (input, length) => input.length > length ? `${input.substring(0, length)}...` : input;

module.exports = bannerController = async (request, reply) => {
  if (!request.query.repo || request.query.repo.split("/").length !== 2) {
    reply.badRequest();
  } else {
    const fullName = request.query.repo;
    const rules = await getRules(request.query.repo);
    const percentForOwner = rules[fullName] || 0;
    const rulesNotForOwner = Object.keys(rules).filter(r => r !== fullName).map((repo) => ({ repo, percent: rules[repo] }));
    
    reply.headers({
      'Content-Type': 'image/svg+xml',
      'Cache-Control': 'max-age=3600'
    })

    reply.send(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${rulesNotForOwner.length === 0 ? 290 : 400} ${rulesNotForOwner.length === 0 ? 97 : 100 + ((rulesNotForOwner.length + 1) * 20)}" width="${rulesNotForOwner.length === 0 ? "300px" : "400px"}" height="${`${rulesNotForOwner.length === 0 ? 100 : 105 + ((rulesNotForOwner.length + 1) * 20)}px`}">
        <rect rx="10" ry="10" stroke-linejoin="round" x="0" y="0" width="${rulesNotForOwner.length === 0 ? 285 : 400}" height="${rulesNotForOwner.length === 0 ? 97 : 100 + ((rulesNotForOwner.length + 1) * 20)}" fill="#ddd" />
        <rect rx="10" ry="10" stroke-linejoin="round" x="5" y="5" width="${rulesNotForOwner.length === 0 ? 275 : 390}" height="${rulesNotForOwner.length === 0 ? 87 : 90 + ((rulesNotForOwner.length + 1) * 20)}" fill="#fff" />
        <svg x="15" y="15" width="255" height="67" viewBox="0 0 255 67" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M96.6966 32H91.8841L86.6478 23.5781L84.8568 24.8633V32H80.6185V12.0117H84.8568V21.1582L86.5247 18.8066L91.9388 12.0117H96.6419L89.6693 20.8574L96.6966 32ZM98.7064 12.7637C98.7064 11.4056 99.4629 10.7266 100.976 10.7266C102.489 10.7266 103.245 11.4056 103.245 12.7637C103.245 13.4108 103.054 13.9167 102.671 14.2812C102.298 14.6367 101.732 14.8145 100.976 14.8145C99.4629 14.8145 98.7064 14.1309 98.7064 12.7637ZM103.054 32H98.8841V16.7148H103.054V32ZM111.079 32L105.255 16.7148H109.617L112.57 25.4238C112.898 26.5267 113.103 27.5703 113.185 28.5547H113.267C113.312 27.6797 113.518 26.6361 113.882 25.4238L116.822 16.7148H121.183L115.359 32H111.079ZM133.091 32L132.285 29.9219H132.175C131.473 30.806 130.749 31.4212 130.001 31.7676C129.263 32.1048 128.297 32.2734 127.103 32.2734C125.635 32.2734 124.478 31.8542 123.63 31.0156C122.792 30.1771 122.372 28.9831 122.372 27.4336C122.372 25.8112 122.937 24.6172 124.068 23.8516C125.207 23.0768 126.921 22.6484 129.208 22.5664L131.861 22.4844V21.8145C131.861 20.265 131.068 19.4902 129.482 19.4902C128.26 19.4902 126.825 19.8594 125.175 20.5977L123.794 17.7812C125.553 16.8607 127.504 16.4004 129.646 16.4004C131.697 16.4004 133.269 16.847 134.363 17.7402C135.456 18.6335 136.003 19.9915 136.003 21.8145V32H133.091ZM131.861 24.918L130.247 24.9727C129.035 25.0091 128.133 25.2279 127.54 25.6289C126.948 26.0299 126.652 26.6406 126.652 27.4609C126.652 28.6367 127.326 29.2246 128.675 29.2246C129.641 29.2246 130.411 28.9466 130.986 28.3906C131.569 27.8346 131.861 27.0964 131.861 26.1758V24.918ZM146.517 32.2734C141.759 32.2734 139.38 29.6621 139.38 24.4395C139.38 21.8418 140.027 19.8594 141.322 18.4922C142.616 17.1159 144.471 16.4277 146.886 16.4277C148.654 16.4277 150.24 16.7741 151.644 17.4668L150.413 20.6934C149.757 20.429 149.146 20.2148 148.581 20.0508C148.016 19.8776 147.451 19.791 146.886 19.791C144.717 19.791 143.632 21.3314 143.632 24.4121C143.632 27.4017 144.717 28.8965 146.886 28.8965C147.688 28.8965 148.431 28.7917 149.115 28.582C149.798 28.3633 150.482 28.026 151.165 27.5703V31.1387C150.491 31.5671 149.807 31.8633 149.115 32.0273C148.431 32.1914 147.565 32.2734 146.517 32.2734ZM168.829 32H164.66V23.0723C164.66 20.8665 163.839 19.7637 162.199 19.7637C161.032 19.7637 160.189 20.1602 159.669 20.9531C159.15 21.7461 158.89 23.0312 158.89 24.8086V32H154.72V10.7266H158.89V15.0605C158.89 15.3978 158.858 16.1908 158.794 17.4395L158.699 18.6699H158.917C159.847 17.1751 161.324 16.4277 163.347 16.4277C165.143 16.4277 166.505 16.9108 167.435 17.877C168.365 18.8431 168.829 20.2285 168.829 22.0332V32ZM84.47 46.0156C83.3971 46.0156 82.5534 46.3958 81.9388 47.1562C81.3242 47.9167 81.0169 48.9661 81.0169 50.3047C81.0169 51.7057 81.3112 52.7656 81.8997 53.4844C82.4935 54.2031 83.3503 54.5625 84.47 54.5625C84.9544 54.5625 85.4232 54.5156 85.8763 54.4219C86.3294 54.3229 86.8008 54.1979 87.2904 54.0469V55.6484C86.3945 55.987 85.3789 56.1562 84.2435 56.1562C82.5716 56.1562 81.2878 55.651 80.3919 54.6406C79.4961 53.625 79.0482 52.1745 79.0482 50.2891C79.0482 49.1016 79.2643 48.0625 79.6966 47.1719C80.1341 46.2812 80.7643 45.599 81.5872 45.125C82.4102 44.651 83.3763 44.4141 84.4857 44.4141C85.6523 44.4141 86.7305 44.6589 87.72 45.1484L87.0482 46.7031C86.6628 46.5208 86.2539 46.362 85.8216 46.2266C85.3945 46.0859 84.944 46.0156 84.47 46.0156ZM94.9622 56L94.595 54.7969H94.5325C94.1159 55.3229 93.6966 55.6823 93.2747 55.875C92.8529 56.0625 92.3112 56.1562 91.6497 56.1562C90.8008 56.1562 90.1367 55.9271 89.6575 55.4688C89.1836 55.0104 88.9466 54.362 88.9466 53.5234C88.9466 52.6328 89.2773 51.9609 89.9388 51.5078C90.6003 51.0547 91.6081 50.8073 92.9622 50.7656L94.4544 50.7188V50.2578C94.4544 49.7057 94.3242 49.2943 94.0638 49.0234C93.8086 48.7474 93.4102 48.6094 92.8685 48.6094C92.4258 48.6094 92.0013 48.6745 91.595 48.8047C91.1888 48.9349 90.7982 49.0885 90.4232 49.2656L89.8294 47.9531C90.2982 47.7083 90.8112 47.5234 91.3685 47.3984C91.9258 47.2682 92.4518 47.2031 92.9466 47.2031C94.0456 47.2031 94.8737 47.4427 95.431 47.9219C95.9935 48.401 96.2747 49.1536 96.2747 50.1797V56H94.9622ZM92.2279 54.75C92.8945 54.75 93.4284 54.5651 93.8294 54.1953C94.2357 53.8203 94.4388 53.2969 94.4388 52.625V51.875L93.3294 51.9219C92.4648 51.9531 91.8346 52.099 91.4388 52.3594C91.0482 52.6146 90.8529 53.0078 90.8529 53.5391C90.8529 53.9245 90.9674 54.224 91.1966 54.4375C91.4258 54.6458 91.7695 54.75 92.2279 54.75ZM104.642 53.5391C104.642 54.3828 104.335 55.0312 103.72 55.4844C103.105 55.9323 102.225 56.1562 101.079 56.1562C99.9284 56.1562 99.0039 55.9818 98.306 55.6328V54.0469C99.3216 54.5156 100.267 54.75 101.142 54.75C102.272 54.75 102.837 54.4089 102.837 53.7266C102.837 53.5078 102.775 53.3255 102.65 53.1797C102.525 53.0339 102.319 52.8828 102.033 52.7266C101.746 52.5703 101.348 52.3932 100.837 52.1953C99.8424 51.8099 99.168 51.4245 98.8138 51.0391C98.4648 50.6536 98.2904 50.1536 98.2904 49.5391C98.2904 48.7995 98.5872 48.2266 99.181 47.8203C99.7799 47.4089 100.592 47.2031 101.618 47.2031C102.634 47.2031 103.595 47.4089 104.501 47.8203L103.908 49.2031C102.975 48.8177 102.191 48.625 101.556 48.625C100.587 48.625 100.103 48.901 100.103 49.4531C100.103 49.724 100.228 49.9531 100.478 50.1406C100.733 50.3281 101.285 50.5859 102.134 50.9141C102.848 51.1901 103.366 51.4427 103.689 51.6719C104.012 51.901 104.251 52.1667 104.408 52.4688C104.564 52.7656 104.642 53.1224 104.642 53.5391ZM110.118 56.1562C108.811 56.1562 107.816 55.776 107.134 55.0156C106.457 54.25 106.118 53.1536 106.118 51.7266C106.118 50.2734 106.473 49.1562 107.181 48.375C107.895 47.5938 108.923 47.2031 110.267 47.2031C111.178 47.2031 111.999 47.3724 112.728 47.7109L112.173 49.1875C111.397 48.8854 110.757 48.7344 110.251 48.7344C108.757 48.7344 108.009 49.7266 108.009 51.7109C108.009 52.6797 108.194 53.4089 108.564 53.8984C108.939 54.3828 109.486 54.625 110.204 54.625C111.022 54.625 111.796 54.4219 112.525 54.0156V55.6172C112.197 55.8099 111.845 55.9479 111.47 56.0312C111.1 56.1146 110.65 56.1562 110.118 56.1562ZM119.962 56L119.595 54.7969H119.533C119.116 55.3229 118.697 55.6823 118.275 55.875C117.853 56.0625 117.311 56.1562 116.65 56.1562C115.801 56.1562 115.137 55.9271 114.658 55.4688C114.184 55.0104 113.947 54.362 113.947 53.5234C113.947 52.6328 114.277 51.9609 114.939 51.5078C115.6 51.0547 116.608 50.8073 117.962 50.7656L119.454 50.7188V50.2578C119.454 49.7057 119.324 49.2943 119.064 49.0234C118.809 48.7474 118.41 48.6094 117.868 48.6094C117.426 48.6094 117.001 48.6745 116.595 48.8047C116.189 48.9349 115.798 49.0885 115.423 49.2656L114.829 47.9531C115.298 47.7083 115.811 47.5234 116.368 47.3984C116.926 47.2682 117.452 47.2031 117.947 47.2031C119.046 47.2031 119.874 47.4427 120.431 47.9219C120.993 48.401 121.275 49.1536 121.275 50.1797V56H119.962ZM117.228 54.75C117.895 54.75 118.428 54.5651 118.829 54.1953C119.236 53.8203 119.439 53.2969 119.439 52.625V51.875L118.329 51.9219C117.465 51.9531 116.835 52.099 116.439 52.3594C116.048 52.6146 115.853 53.0078 115.853 53.5391C115.853 53.9245 115.967 54.224 116.197 54.4375C116.426 54.6458 116.77 54.75 117.228 54.75ZM126.751 56.1562C125.673 56.1562 124.832 55.7656 124.228 54.9844C123.624 54.2031 123.322 53.1068 123.322 51.6953C123.322 50.2786 123.626 49.1771 124.236 48.3906C124.85 47.599 125.699 47.2031 126.783 47.2031C127.918 47.2031 128.783 47.6224 129.376 48.4609H129.47C129.382 47.8411 129.337 47.3516 129.337 46.9922V43.8438H131.181V56H129.743L129.423 54.8672H129.337C128.749 55.7266 127.887 56.1562 126.751 56.1562ZM127.243 54.6719C127.999 54.6719 128.548 54.4609 128.892 54.0391C129.236 53.612 129.413 52.9219 129.423 51.9688V51.7109C129.423 50.6224 129.246 49.849 128.892 49.3906C128.538 48.9323 127.983 48.7031 127.228 48.7031C126.582 48.7031 126.085 48.9661 125.736 49.4922C125.387 50.013 125.212 50.7578 125.212 51.7266C125.212 52.6849 125.382 53.4167 125.72 53.9219C126.059 54.4219 126.566 54.6719 127.243 54.6719ZM135.642 56H133.806V47.3594H135.642V56ZM133.697 45.0703C133.697 44.7422 133.785 44.4896 133.962 44.3125C134.145 44.1354 134.402 44.0469 134.736 44.0469C135.059 44.0469 135.309 44.1354 135.486 44.3125C135.668 44.4896 135.759 44.7422 135.759 45.0703C135.759 45.3828 135.668 45.6302 135.486 45.8125C135.309 45.9896 135.059 46.0781 134.736 46.0781C134.402 46.0781 134.145 45.9896 133.962 45.8125C133.785 45.6302 133.697 45.3828 133.697 45.0703ZM145.876 56H144.033V50.6875C144.033 50.0208 143.897 49.5234 143.626 49.1953C143.361 48.8672 142.936 48.7031 142.353 48.7031C141.577 48.7031 141.009 48.9323 140.65 49.3906C140.29 49.849 140.111 50.6172 140.111 51.6953V56H138.275V47.3594H139.712L139.97 48.4922H140.064C140.324 48.0807 140.694 47.763 141.173 47.5391C141.652 47.3151 142.184 47.2031 142.767 47.2031C144.84 47.2031 145.876 48.2578 145.876 50.3672V56ZM155.728 47.3594V48.3672L154.251 48.6406C154.387 48.8229 154.499 49.0469 154.587 49.3125C154.676 49.5781 154.72 49.8594 154.72 50.1562C154.72 51.0469 154.413 51.7474 153.798 52.2578C153.184 52.7682 152.337 53.0234 151.259 53.0234C150.983 53.0234 150.733 53.0026 150.509 52.9609C150.113 53.2057 149.915 53.4922 149.915 53.8203C149.915 54.0182 150.007 54.1667 150.189 54.2656C150.376 54.3646 150.717 54.4141 151.212 54.4141H152.72C153.673 54.4141 154.397 54.6172 154.892 55.0234C155.387 55.4297 155.634 56.0156 155.634 56.7812C155.634 57.7604 155.23 58.5156 154.423 59.0469C153.616 59.5781 152.449 59.8438 150.923 59.8438C149.746 59.8438 148.848 59.6354 148.228 59.2188C147.608 58.8021 147.298 58.2083 147.298 57.4375C147.298 56.9062 147.465 56.4583 147.798 56.0938C148.137 55.7344 148.608 55.4844 149.212 55.3438C148.967 55.2396 148.764 55.0729 148.603 54.8438C148.447 54.6094 148.368 54.3646 148.368 54.1094C148.368 53.7865 148.46 53.513 148.642 53.2891C148.824 53.0651 149.095 52.8438 149.454 52.625C149.007 52.4323 148.642 52.1198 148.361 51.6875C148.085 51.25 147.947 50.7396 147.947 50.1562C147.947 49.2188 148.241 48.4922 148.829 47.9766C149.423 47.4609 150.267 47.2031 151.361 47.2031C151.605 47.2031 151.861 47.2214 152.126 47.2578C152.397 47.2891 152.6 47.3229 152.736 47.3594H155.728ZM148.939 57.3438C148.939 57.7396 149.116 58.0443 149.47 58.2578C149.829 58.4714 150.332 58.5781 150.978 58.5781C151.978 58.5781 152.723 58.4349 153.212 58.1484C153.702 57.862 153.947 57.4818 153.947 57.0078C153.947 56.6328 153.811 56.3646 153.54 56.2031C153.275 56.0469 152.777 55.9688 152.048 55.9688H150.658C150.132 55.9688 149.712 56.0911 149.4 56.3359C149.092 56.5859 148.939 56.9219 148.939 57.3438ZM149.728 50.1562C149.728 50.6979 149.866 51.1146 150.142 51.4062C150.423 51.6979 150.824 51.8438 151.345 51.8438C152.408 51.8438 152.939 51.276 152.939 50.1406C152.939 49.5781 152.806 49.1458 152.54 48.8438C152.28 48.5365 151.882 48.3828 151.345 48.3828C150.814 48.3828 150.41 48.5339 150.134 48.8359C149.863 49.138 149.728 49.5781 149.728 50.1562ZM164.408 56.1562C163.329 56.1562 162.488 55.7656 161.884 54.9844C161.28 54.2031 160.978 53.1068 160.978 51.6953C160.978 50.2786 161.283 49.1771 161.892 48.3906C162.507 47.599 163.355 47.2031 164.439 47.2031C165.574 47.2031 166.439 47.6224 167.033 48.4609H167.126C167.038 47.8411 166.993 47.3516 166.993 46.9922V43.8438H168.837V56H167.4L167.079 54.8672H166.993C166.405 55.7266 165.543 56.1562 164.408 56.1562ZM164.9 54.6719C165.655 54.6719 166.204 54.4609 166.548 54.0391C166.892 53.612 167.069 52.9219 167.079 51.9688V51.7109C167.079 50.6224 166.902 49.849 166.548 49.3906C166.194 48.9323 165.639 48.7031 164.884 48.7031C164.238 48.7031 163.741 48.9661 163.392 49.4922C163.043 50.013 162.868 50.7578 162.868 51.7266C162.868 52.6849 163.038 53.4167 163.376 53.9219C163.715 54.4219 164.223 54.6719 164.9 54.6719ZM179.126 51.6641C179.126 53.0755 178.764 54.1771 178.04 54.9688C177.316 55.7604 176.309 56.1562 175.017 56.1562C174.21 56.1562 173.496 55.974 172.876 55.6094C172.257 55.2448 171.78 54.7214 171.447 54.0391C171.113 53.3568 170.947 52.5651 170.947 51.6641C170.947 50.263 171.306 49.1693 172.025 48.3828C172.743 47.5964 173.757 47.2031 175.064 47.2031C176.314 47.2031 177.303 47.6068 178.033 48.4141C178.762 49.2161 179.126 50.2995 179.126 51.6641ZM172.837 51.6641C172.837 53.6589 173.574 54.6562 175.048 54.6562C176.507 54.6562 177.236 53.6589 177.236 51.6641C177.236 49.6901 176.501 48.7031 175.033 48.7031C174.262 48.7031 173.702 48.9583 173.353 49.4688C173.009 49.9792 172.837 50.7109 172.837 51.6641ZM188.845 56H187.001V50.6875C187.001 50.0208 186.866 49.5234 186.595 49.1953C186.329 48.8672 185.905 48.7031 185.322 48.7031C184.546 48.7031 183.978 48.9323 183.618 49.3906C183.259 49.849 183.079 50.6172 183.079 51.6953V56H181.243V47.3594H182.681L182.939 48.4922H183.033C183.293 48.0807 183.663 47.763 184.142 47.5391C184.621 47.3151 185.152 47.2031 185.736 47.2031C187.809 47.2031 188.845 48.2578 188.845 50.3672V56ZM196.806 56L196.439 54.7969H196.376C195.96 55.3229 195.54 55.6823 195.118 55.875C194.697 56.0625 194.155 56.1562 193.493 56.1562C192.645 56.1562 191.98 55.9271 191.501 55.4688C191.027 55.0104 190.79 54.362 190.79 53.5234C190.79 52.6328 191.121 51.9609 191.783 51.5078C192.444 51.0547 193.452 50.8073 194.806 50.7656L196.298 50.7188V50.2578C196.298 49.7057 196.168 49.2943 195.908 49.0234C195.652 48.7474 195.254 48.6094 194.712 48.6094C194.27 48.6094 193.845 48.6745 193.439 48.8047C193.033 48.9349 192.642 49.0885 192.267 49.2656L191.673 47.9531C192.142 47.7083 192.655 47.5234 193.212 47.3984C193.77 47.2682 194.296 47.2031 194.79 47.2031C195.889 47.2031 196.717 47.4427 197.275 47.9219C197.837 48.401 198.118 49.1536 198.118 50.1797V56H196.806ZM194.072 54.75C194.738 54.75 195.272 54.5651 195.673 54.1953C196.079 53.8203 196.283 53.2969 196.283 52.625V51.875L195.173 51.9219C194.309 51.9531 193.678 52.099 193.283 52.3594C192.892 52.6146 192.697 53.0078 192.697 53.5391C192.697 53.9245 192.811 54.224 193.04 54.4375C193.27 54.6458 193.613 54.75 194.072 54.75ZM203.9 54.6719C204.348 54.6719 204.796 54.6016 205.243 54.4609V55.8438C205.04 55.9323 204.777 56.0052 204.454 56.0625C204.137 56.125 203.806 56.1562 203.462 56.1562C201.723 56.1562 200.853 55.2396 200.853 53.4062V48.75H199.673V47.9375L200.939 47.2656L201.564 45.4375H202.697V47.3594H205.158V48.75H202.697V53.375C202.697 53.8177 202.806 54.1458 203.025 54.3594C203.249 54.5677 203.54 54.6719 203.9 54.6719ZM208.814 56H206.978V47.3594H208.814V56ZM206.868 45.0703C206.868 44.7422 206.957 44.4896 207.134 44.3125C207.316 44.1354 207.574 44.0469 207.908 44.0469C208.23 44.0469 208.48 44.1354 208.658 44.3125C208.84 44.4896 208.931 44.7422 208.931 45.0703C208.931 45.3828 208.84 45.6302 208.658 45.8125C208.48 45.9896 208.23 46.0781 207.908 46.0781C207.574 46.0781 207.316 45.9896 207.134 45.8125C206.957 45.6302 206.868 45.3828 206.868 45.0703ZM219.111 51.6641C219.111 53.0755 218.749 54.1771 218.025 54.9688C217.301 55.7604 216.293 56.1562 215.001 56.1562C214.194 56.1562 213.48 55.974 212.861 55.6094C212.241 55.2448 211.764 54.7214 211.431 54.0391C211.098 53.3568 210.931 52.5651 210.931 51.6641C210.931 50.263 211.29 49.1693 212.009 48.3828C212.728 47.5964 213.741 47.2031 215.048 47.2031C216.298 47.2031 217.288 47.6068 218.017 48.4141C218.746 49.2161 219.111 50.2995 219.111 51.6641ZM212.822 51.6641C212.822 53.6589 213.559 54.6562 215.033 54.6562C216.491 54.6562 217.22 53.6589 217.22 51.6641C217.22 49.6901 216.486 48.7031 215.017 48.7031C214.246 48.7031 213.686 48.9583 213.337 49.4688C212.993 49.9792 212.822 50.7109 212.822 51.6641ZM228.829 56H226.986V50.6875C226.986 50.0208 226.85 49.5234 226.579 49.1953C226.314 48.8672 225.889 48.7031 225.306 48.7031C224.53 48.7031 223.962 48.9323 223.603 49.3906C223.243 49.849 223.064 50.6172 223.064 51.6953V56H221.228V47.3594H222.665L222.923 48.4922H223.017C223.277 48.0807 223.647 47.763 224.126 47.5391C224.605 47.3151 225.137 47.2031 225.72 47.2031C227.793 47.2031 228.829 48.2578 228.829 50.3672V56ZM237.189 53.5391C237.189 54.3828 236.882 55.0312 236.267 55.4844C235.652 55.9323 234.772 56.1562 233.626 56.1562C232.475 56.1562 231.551 55.9818 230.853 55.6328V54.0469C231.868 54.5156 232.814 54.75 233.689 54.75C234.819 54.75 235.384 54.4089 235.384 53.7266C235.384 53.5078 235.322 53.3255 235.197 53.1797C235.072 53.0339 234.866 52.8828 234.579 52.7266C234.293 52.5703 233.895 52.3932 233.384 52.1953C232.389 51.8099 231.715 51.4245 231.361 51.0391C231.012 50.6536 230.837 50.1536 230.837 49.5391C230.837 48.7995 231.134 48.2266 231.728 47.8203C232.327 47.4089 233.139 47.2031 234.165 47.2031C235.181 47.2031 236.142 47.4089 237.048 47.8203L236.454 49.2031C235.522 48.8177 234.738 48.625 234.103 48.625C233.134 48.625 232.65 48.901 232.65 49.4531C232.65 49.724 232.775 49.9531 233.025 50.1406C233.28 50.3281 233.832 50.5859 234.681 50.9141C235.395 51.1901 235.913 51.4427 236.236 51.6719C236.559 51.901 236.798 52.1667 236.954 52.4688C237.111 52.7656 237.189 53.1224 237.189 53.5391Z" fill="#2D2C2C"/>
          <path d="M59.6375 53.51C59.7203 53.5647 59.758 53.6256 59.774 53.6676C56.8219 56.2859 53.3481 58.4759 49.4871 60.1217C44.2636 62.3484 38.4934 63.51 32.6317 63.4999C26.77 63.4899 21.0055 62.3084 15.7929 60.064C11.9409 58.4055 8.47844 56.2046 5.5394 53.5774C5.55553 53.535 5.59364 53.4735 5.67758 53.4186C5.74704 53.3731 5.85286 53.3345 6.02586 53.355C6.21232 53.3772 6.43428 53.468 6.62425 53.6405C9.54262 56.2914 12.959 58.4711 16.7168 60.0892C21.6812 62.2267 27.1278 63.3354 32.6362 63.3448C38.1445 63.3543 43.5958 62.2644 48.5694 60.1442C52.336 58.5385 55.7633 56.3696 58.6942 53.7276C58.8841 53.5564 59.1056 53.4669 59.2913 53.4455C59.4636 53.4257 59.5687 53.4646 59.6375 53.51Z" stroke="#2D2C2C" stroke-width="7"/>
          <path d="M56.2764 26.8487C56.2764 39.6825 45.658 50.1974 32.4211 50.1974C19.1842 50.1974 8.5658 39.6825 8.5658 26.8487C8.5658 14.015 19.1842 3.5 32.4211 3.5C45.658 3.5 56.2764 14.015 56.2764 26.8487Z" fill="white" stroke="#2D2C2C" stroke-width="7"/>
        </svg>

        ${rulesNotForOwner.length !== 0 && `<g style="user-select: none; -ms-user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; color: #2D2C2C;">
          <line stroke-linecap="round" x1="15" y1="100" x2="80" y2="100" stroke-width="5" stroke="#ddd" />
          <text x="100" font-family="Segoe UI, Ubuntu, Sans-Serif" className="unselectable" y="105">${truncate(fullName, 26)} - ${percentForOwner}%</text>
        </g>`}

        ${rulesNotForOwner.map((r, i) => `<g>
          <line stroke-linecap="round" x1="32" y1="${100 + (i === rulesNotForOwner.length - 1 ? 20 : 22) * i}" x2="32" y2="${125 + (i === rulesNotForOwner.length - 1 ? 20 : 22) * i}" stroke-width="5" stroke="#ddd" />
          <line stroke-linecap="round" x1="32" y1="${120 + 20 * i}" x2="100" y2="${120 + 20 * i}" stroke-width="5" stroke="#ddd" />
          <g style="user-select: none; -ms-user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; color: #2D2C2C;"><text font-family="Segoe UI, Ubuntu, Sans-Serif" font-weight="300" className="unselectable" x="120" y="${125 + 20 * i}">${truncate(r.repo, 24)} - ${r.percent}%</text></g>
        </g>`).join(" ")}
      </svg>
    `)
  }
}

