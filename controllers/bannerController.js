const { getRules } = require("../utils")

const truncate = (input, length) => input.length > length ? `${input.substring(0, length)}...` : input;

module.exports = bannerController = async (request, reply) => {
  if (!request.query.repo || request.query.repo.split("/").length !== 2) {
    reply.badRequest();
  } else {
    const fullName = request.query.repo;
    const rules = await getRules(request.query.repo);
    const percentForOwner = rules[fullName] || 0;
    const rulesNotForOwner = Object.keys(rules).filter(r => r !== fullName).map((repo) => ({ repo, percent: rules[repo] }));

    reply.headers({
      'Content-Type': 'image/svg+xml',
      'Cache-Control': 'max-age=3600'
    })

    reply.send(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${rulesNotForOwner.length === 0 ? 290 : 400} ${rulesNotForOwner.length === 0 ? 97 : 100 + ((rulesNotForOwner.length + 1) * 20)}" width="${rulesNotForOwner.length === 0 ? "300px" : "400px"}" height="${`${rulesNotForOwner.length === 0 ? 100 : 105 + ((rulesNotForOwner.length + 1) * 20)}px`}">
        <rect rx="10" ry="10" stroke-linejoin="round" x="0" y="0" width="${rulesNotForOwner.length === 0 ? 285 : 400}" height="${rulesNotForOwner.length === 0 ? 97 : 100 + ((rulesNotForOwner.length + 1) * 20)}" fill="#ddd" />
        <rect rx="10" ry="10" stroke-linejoin="round" x="5" y="5" width="${rulesNotForOwner.length === 0 ? 275 : 390}" height="${rulesNotForOwner.length === 0 ? 87 : 90 + ((rulesNotForOwner.length + 1) * 20)}" fill="#fff" />
        <svg x="15" y="15" width="255" height="67" viewBox="0 0 255 67" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M59.6375 53.51C59.7203 53.5647 59.758 53.6256 59.774 53.6676C56.8219 56.2859 53.3481 58.4759 49.4871 60.1217C44.2636 62.3484 38.4934 63.51 32.6317 63.4999C26.77 63.4899 21.0055 62.3084 15.7929 60.064C11.9409 58.4055 8.47844 56.2046 5.5394 53.5774C5.55553 53.535 5.59364 53.4735 5.67758 53.4186C5.74704 53.3731 5.85286 53.3345 6.02586 53.355C6.21232 53.3772 6.43428 53.468 6.62425 53.6405C9.54262 56.2914 12.959 58.4711 16.7168 60.0892C21.6812 62.2267 27.1278 63.3354 32.6362 63.3448C38.1445 63.3543 43.5958 62.2644 48.5694 60.1442C52.336 58.5385 55.7633 56.3696 58.6942 53.7276C58.8841 53.5564 59.1056 53.4669 59.2913 53.4455C59.4636 53.4257 59.5687 53.4646 59.6375 53.51Z" stroke="#2D2C2C" stroke-width="7"/>
          <path d="M55.5 26.5C55.5 39.2025 45.2025 49.5 32.5 49.5C19.7975 49.5 9.5 39.2025 9.5 26.5C9.5 13.7975 19.7975 3.5 32.5 3.5C45.2025 3.5 55.5 13.7975 55.5 26.5Z" stroke="#2D2C2C" stroke-width="7"/>
          <path d="M96.5938 32H91.7812L86.5449 23.5781L84.7539 24.8633V32H80.5156V12.0117H84.7539V21.1582L86.4219 18.8066L91.8359 12.0117H96.5391L89.5664 20.8574L96.5938 32ZM98.6035 12.7637C98.6035 11.4056 99.36 10.7266 100.873 10.7266C102.386 10.7266 103.143 11.4056 103.143 12.7637C103.143 13.4108 102.951 13.9167 102.568 14.2812C102.195 14.6367 101.63 14.8145 100.873 14.8145C99.36 14.8145 98.6035 14.1309 98.6035 12.7637ZM102.951 32H98.7812V16.7148H102.951V32ZM110.977 32L105.152 16.7148H109.514L112.467 25.4238C112.795 26.5267 113 27.5703 113.082 28.5547H113.164C113.21 27.6797 113.415 26.6361 113.779 25.4238L116.719 16.7148H121.08L115.256 32H110.977ZM132.988 32L132.182 29.9219H132.072C131.37 30.806 130.646 31.4212 129.898 31.7676C129.16 32.1048 128.194 32.2734 127 32.2734C125.533 32.2734 124.375 31.8542 123.527 31.0156C122.689 30.1771 122.27 28.9831 122.27 27.4336C122.27 25.8112 122.835 24.6172 123.965 23.8516C125.104 23.0768 126.818 22.6484 129.105 22.5664L131.758 22.4844V21.8145C131.758 20.265 130.965 19.4902 129.379 19.4902C128.158 19.4902 126.722 19.8594 125.072 20.5977L123.691 17.7812C125.451 16.8607 127.401 16.4004 129.543 16.4004C131.594 16.4004 133.166 16.847 134.26 17.7402C135.354 18.6335 135.9 19.9915 135.9 21.8145V32H132.988ZM131.758 24.918L130.145 24.9727C128.932 25.0091 128.03 25.2279 127.438 25.6289C126.845 26.0299 126.549 26.6406 126.549 27.4609C126.549 28.6367 127.223 29.2246 128.572 29.2246C129.538 29.2246 130.309 28.9466 130.883 28.3906C131.466 27.8346 131.758 27.0964 131.758 26.1758V24.918ZM146.414 32.2734C141.656 32.2734 139.277 29.6621 139.277 24.4395C139.277 21.8418 139.924 19.8594 141.219 18.4922C142.513 17.1159 144.368 16.4277 146.783 16.4277C148.551 16.4277 150.137 16.7741 151.541 17.4668L150.311 20.6934C149.654 20.429 149.044 20.2148 148.479 20.0508C147.913 19.8776 147.348 19.791 146.783 19.791C144.614 19.791 143.529 21.3314 143.529 24.4121C143.529 27.4017 144.614 28.8965 146.783 28.8965C147.585 28.8965 148.328 28.7917 149.012 28.582C149.695 28.3633 150.379 28.026 151.062 27.5703V31.1387C150.388 31.5671 149.704 31.8633 149.012 32.0273C148.328 32.1914 147.462 32.2734 146.414 32.2734ZM168.727 32H164.557V23.0723C164.557 20.8665 163.736 19.7637 162.096 19.7637C160.929 19.7637 160.086 20.1602 159.566 20.9531C159.047 21.7461 158.787 23.0312 158.787 24.8086V32H154.617V10.7266H158.787V15.0605C158.787 15.3978 158.755 16.1908 158.691 17.4395L158.596 18.6699H158.814C159.744 17.1751 161.221 16.4277 163.244 16.4277C165.04 16.4277 166.402 16.9108 167.332 17.877C168.262 18.8431 168.727 20.2285 168.727 22.0332V32ZM84.3672 46.0156C83.2943 46.0156 82.4505 46.3958 81.8359 47.1562C81.2214 47.9167 80.9141 48.9661 80.9141 50.3047C80.9141 51.7057 81.2083 52.7656 81.7969 53.4844C82.3906 54.2031 83.2474 54.5625 84.3672 54.5625C84.8516 54.5625 85.3203 54.5156 85.7734 54.4219C86.2266 54.3229 86.6979 54.1979 87.1875 54.0469V55.6484C86.2917 55.987 85.276 56.1562 84.1406 56.1562C82.4688 56.1562 81.1849 55.651 80.2891 54.6406C79.3932 53.625 78.9453 52.1745 78.9453 50.2891C78.9453 49.1016 79.1615 48.0625 79.5938 47.1719C80.0312 46.2812 80.6615 45.599 81.4844 45.125C82.3073 44.651 83.2734 44.4141 84.3828 44.4141C85.5495 44.4141 86.6276 44.6589 87.6172 45.1484L86.9453 46.7031C86.5599 46.5208 86.151 46.362 85.7188 46.2266C85.2917 46.0859 84.8411 46.0156 84.3672 46.0156ZM94.8594 56L94.4922 54.7969H94.4297C94.013 55.3229 93.5938 55.6823 93.1719 55.875C92.75 56.0625 92.2083 56.1562 91.5469 56.1562C90.6979 56.1562 90.0339 55.9271 89.5547 55.4688C89.0807 55.0104 88.8438 54.362 88.8438 53.5234C88.8438 52.6328 89.1745 51.9609 89.8359 51.5078C90.4974 51.0547 91.5052 50.8073 92.8594 50.7656L94.3516 50.7188V50.2578C94.3516 49.7057 94.2214 49.2943 93.9609 49.0234C93.7057 48.7474 93.3073 48.6094 92.7656 48.6094C92.3229 48.6094 91.8984 48.6745 91.4922 48.8047C91.0859 48.9349 90.6953 49.0885 90.3203 49.2656L89.7266 47.9531C90.1953 47.7083 90.7083 47.5234 91.2656 47.3984C91.8229 47.2682 92.349 47.2031 92.8438 47.2031C93.9427 47.2031 94.7708 47.4427 95.3281 47.9219C95.8906 48.401 96.1719 49.1536 96.1719 50.1797V56H94.8594ZM92.125 54.75C92.7917 54.75 93.3255 54.5651 93.7266 54.1953C94.1328 53.8203 94.3359 53.2969 94.3359 52.625V51.875L93.2266 51.9219C92.362 51.9531 91.7318 52.099 91.3359 52.3594C90.9453 52.6146 90.75 53.0078 90.75 53.5391C90.75 53.9245 90.8646 54.224 91.0938 54.4375C91.3229 54.6458 91.6667 54.75 92.125 54.75ZM104.539 53.5391C104.539 54.3828 104.232 55.0312 103.617 55.4844C103.003 55.9323 102.122 56.1562 100.977 56.1562C99.8255 56.1562 98.901 55.9818 98.2031 55.6328V54.0469C99.2188 54.5156 100.164 54.75 101.039 54.75C102.169 54.75 102.734 54.4089 102.734 53.7266C102.734 53.5078 102.672 53.3255 102.547 53.1797C102.422 53.0339 102.216 52.8828 101.93 52.7266C101.643 52.5703 101.245 52.3932 100.734 52.1953C99.7396 51.8099 99.0651 51.4245 98.7109 51.0391C98.362 50.6536 98.1875 50.1536 98.1875 49.5391C98.1875 48.7995 98.4844 48.2266 99.0781 47.8203C99.6771 47.4089 100.49 47.2031 101.516 47.2031C102.531 47.2031 103.492 47.4089 104.398 47.8203L103.805 49.2031C102.872 48.8177 102.089 48.625 101.453 48.625C100.484 48.625 100 48.901 100 49.4531C100 49.724 100.125 49.9531 100.375 50.1406C100.63 50.3281 101.182 50.5859 102.031 50.9141C102.745 51.1901 103.263 51.4427 103.586 51.6719C103.909 51.901 104.148 52.1667 104.305 52.4688C104.461 52.7656 104.539 53.1224 104.539 53.5391ZM110.016 56.1562C108.708 56.1562 107.714 55.776 107.031 55.0156C106.354 54.25 106.016 53.1536 106.016 51.7266C106.016 50.2734 106.37 49.1562 107.078 48.375C107.792 47.5938 108.82 47.2031 110.164 47.2031C111.076 47.2031 111.896 47.3724 112.625 47.7109L112.07 49.1875C111.294 48.8854 110.654 48.7344 110.148 48.7344C108.654 48.7344 107.906 49.7266 107.906 51.7109C107.906 52.6797 108.091 53.4089 108.461 53.8984C108.836 54.3828 109.383 54.625 110.102 54.625C110.919 54.625 111.693 54.4219 112.422 54.0156V55.6172C112.094 55.8099 111.742 55.9479 111.367 56.0312C110.997 56.1146 110.547 56.1562 110.016 56.1562ZM119.859 56L119.492 54.7969H119.43C119.013 55.3229 118.594 55.6823 118.172 55.875C117.75 56.0625 117.208 56.1562 116.547 56.1562C115.698 56.1562 115.034 55.9271 114.555 55.4688C114.081 55.0104 113.844 54.362 113.844 53.5234C113.844 52.6328 114.174 51.9609 114.836 51.5078C115.497 51.0547 116.505 50.8073 117.859 50.7656L119.352 50.7188V50.2578C119.352 49.7057 119.221 49.2943 118.961 49.0234C118.706 48.7474 118.307 48.6094 117.766 48.6094C117.323 48.6094 116.898 48.6745 116.492 48.8047C116.086 48.9349 115.695 49.0885 115.32 49.2656L114.727 47.9531C115.195 47.7083 115.708 47.5234 116.266 47.3984C116.823 47.2682 117.349 47.2031 117.844 47.2031C118.943 47.2031 119.771 47.4427 120.328 47.9219C120.891 48.401 121.172 49.1536 121.172 50.1797V56H119.859ZM117.125 54.75C117.792 54.75 118.326 54.5651 118.727 54.1953C119.133 53.8203 119.336 53.2969 119.336 52.625V51.875L118.227 51.9219C117.362 51.9531 116.732 52.099 116.336 52.3594C115.945 52.6146 115.75 53.0078 115.75 53.5391C115.75 53.9245 115.865 54.224 116.094 54.4375C116.323 54.6458 116.667 54.75 117.125 54.75ZM126.648 56.1562C125.57 56.1562 124.729 55.7656 124.125 54.9844C123.521 54.2031 123.219 53.1068 123.219 51.6953C123.219 50.2786 123.523 49.1771 124.133 48.3906C124.747 47.599 125.596 47.2031 126.68 47.2031C127.815 47.2031 128.68 47.6224 129.273 48.4609H129.367C129.279 47.8411 129.234 47.3516 129.234 46.9922V43.8438H131.078V56H129.641L129.32 54.8672H129.234C128.646 55.7266 127.784 56.1562 126.648 56.1562ZM127.141 54.6719C127.896 54.6719 128.445 54.4609 128.789 54.0391C129.133 53.612 129.31 52.9219 129.32 51.9688V51.7109C129.32 50.6224 129.143 49.849 128.789 49.3906C128.435 48.9323 127.88 48.7031 127.125 48.7031C126.479 48.7031 125.982 48.9661 125.633 49.4922C125.284 50.013 125.109 50.7578 125.109 51.7266C125.109 52.6849 125.279 53.4167 125.617 53.9219C125.956 54.4219 126.464 54.6719 127.141 54.6719ZM135.539 56H133.703V47.3594H135.539V56ZM133.594 45.0703C133.594 44.7422 133.682 44.4896 133.859 44.3125C134.042 44.1354 134.299 44.0469 134.633 44.0469C134.956 44.0469 135.206 44.1354 135.383 44.3125C135.565 44.4896 135.656 44.7422 135.656 45.0703C135.656 45.3828 135.565 45.6302 135.383 45.8125C135.206 45.9896 134.956 46.0781 134.633 46.0781C134.299 46.0781 134.042 45.9896 133.859 45.8125C133.682 45.6302 133.594 45.3828 133.594 45.0703ZM145.773 56H143.93V50.6875C143.93 50.0208 143.794 49.5234 143.523 49.1953C143.258 48.8672 142.833 48.7031 142.25 48.7031C141.474 48.7031 140.906 48.9323 140.547 49.3906C140.188 49.849 140.008 50.6172 140.008 51.6953V56H138.172V47.3594H139.609L139.867 48.4922H139.961C140.221 48.0807 140.591 47.763 141.07 47.5391C141.549 47.3151 142.081 47.2031 142.664 47.2031C144.737 47.2031 145.773 48.2578 145.773 50.3672V56ZM155.625 47.3594V48.3672L154.148 48.6406C154.284 48.8229 154.396 49.0469 154.484 49.3125C154.573 49.5781 154.617 49.8594 154.617 50.1562C154.617 51.0469 154.31 51.7474 153.695 52.2578C153.081 52.7682 152.234 53.0234 151.156 53.0234C150.88 53.0234 150.63 53.0026 150.406 52.9609C150.01 53.2057 149.812 53.4922 149.812 53.8203C149.812 54.0182 149.904 54.1667 150.086 54.2656C150.273 54.3646 150.615 54.4141 151.109 54.4141H152.617C153.57 54.4141 154.294 54.6172 154.789 55.0234C155.284 55.4297 155.531 56.0156 155.531 56.7812C155.531 57.7604 155.128 58.5156 154.32 59.0469C153.513 59.5781 152.346 59.8438 150.82 59.8438C149.643 59.8438 148.745 59.6354 148.125 59.2188C147.505 58.8021 147.195 58.2083 147.195 57.4375C147.195 56.9062 147.362 56.4583 147.695 56.0938C148.034 55.7344 148.505 55.4844 149.109 55.3438C148.865 55.2396 148.661 55.0729 148.5 54.8438C148.344 54.6094 148.266 54.3646 148.266 54.1094C148.266 53.7865 148.357 53.513 148.539 53.2891C148.721 53.0651 148.992 52.8438 149.352 52.625C148.904 52.4323 148.539 52.1198 148.258 51.6875C147.982 51.25 147.844 50.7396 147.844 50.1562C147.844 49.2188 148.138 48.4922 148.727 47.9766C149.32 47.4609 150.164 47.2031 151.258 47.2031C151.503 47.2031 151.758 47.2214 152.023 47.2578C152.294 47.2891 152.497 47.3229 152.633 47.3594H155.625ZM148.836 57.3438C148.836 57.7396 149.013 58.0443 149.367 58.2578C149.727 58.4714 150.229 58.5781 150.875 58.5781C151.875 58.5781 152.62 58.4349 153.109 58.1484C153.599 57.862 153.844 57.4818 153.844 57.0078C153.844 56.6328 153.708 56.3646 153.438 56.2031C153.172 56.0469 152.674 55.9688 151.945 55.9688H150.555C150.029 55.9688 149.609 56.0911 149.297 56.3359C148.99 56.5859 148.836 56.9219 148.836 57.3438ZM149.625 50.1562C149.625 50.6979 149.763 51.1146 150.039 51.4062C150.32 51.6979 150.721 51.8438 151.242 51.8438C152.305 51.8438 152.836 51.276 152.836 50.1406C152.836 49.5781 152.703 49.1458 152.438 48.8438C152.177 48.5365 151.779 48.3828 151.242 48.3828C150.711 48.3828 150.307 48.5339 150.031 48.8359C149.76 49.138 149.625 49.5781 149.625 50.1562ZM164.305 56.1562C163.227 56.1562 162.385 55.7656 161.781 54.9844C161.177 54.2031 160.875 53.1068 160.875 51.6953C160.875 50.2786 161.18 49.1771 161.789 48.3906C162.404 47.599 163.253 47.2031 164.336 47.2031C165.471 47.2031 166.336 47.6224 166.93 48.4609H167.023C166.935 47.8411 166.891 47.3516 166.891 46.9922V43.8438H168.734V56H167.297L166.977 54.8672H166.891C166.302 55.7266 165.44 56.1562 164.305 56.1562ZM164.797 54.6719C165.552 54.6719 166.102 54.4609 166.445 54.0391C166.789 53.612 166.966 52.9219 166.977 51.9688V51.7109C166.977 50.6224 166.799 49.849 166.445 49.3906C166.091 48.9323 165.536 48.7031 164.781 48.7031C164.135 48.7031 163.638 48.9661 163.289 49.4922C162.94 50.013 162.766 50.7578 162.766 51.7266C162.766 52.6849 162.935 53.4167 163.273 53.9219C163.612 54.4219 164.12 54.6719 164.797 54.6719ZM179.023 51.6641C179.023 53.0755 178.661 54.1771 177.938 54.9688C177.214 55.7604 176.206 56.1562 174.914 56.1562C174.107 56.1562 173.393 55.974 172.773 55.6094C172.154 55.2448 171.677 54.7214 171.344 54.0391C171.01 53.3568 170.844 52.5651 170.844 51.6641C170.844 50.263 171.203 49.1693 171.922 48.3828C172.641 47.5964 173.654 47.2031 174.961 47.2031C176.211 47.2031 177.201 47.6068 177.93 48.4141C178.659 49.2161 179.023 50.2995 179.023 51.6641ZM172.734 51.6641C172.734 53.6589 173.471 54.6562 174.945 54.6562C176.404 54.6562 177.133 53.6589 177.133 51.6641C177.133 49.6901 176.398 48.7031 174.93 48.7031C174.159 48.7031 173.599 48.9583 173.25 49.4688C172.906 49.9792 172.734 50.7109 172.734 51.6641ZM188.742 56H186.898V50.6875C186.898 50.0208 186.763 49.5234 186.492 49.1953C186.227 48.8672 185.802 48.7031 185.219 48.7031C184.443 48.7031 183.875 48.9323 183.516 49.3906C183.156 49.849 182.977 50.6172 182.977 51.6953V56H181.141V47.3594H182.578L182.836 48.4922H182.93C183.19 48.0807 183.56 47.763 184.039 47.5391C184.518 47.3151 185.049 47.2031 185.633 47.2031C187.706 47.2031 188.742 48.2578 188.742 50.3672V56ZM196.703 56L196.336 54.7969H196.273C195.857 55.3229 195.438 55.6823 195.016 55.875C194.594 56.0625 194.052 56.1562 193.391 56.1562C192.542 56.1562 191.878 55.9271 191.398 55.4688C190.924 55.0104 190.688 54.362 190.688 53.5234C190.688 52.6328 191.018 51.9609 191.68 51.5078C192.341 51.0547 193.349 50.8073 194.703 50.7656L196.195 50.7188V50.2578C196.195 49.7057 196.065 49.2943 195.805 49.0234C195.549 48.7474 195.151 48.6094 194.609 48.6094C194.167 48.6094 193.742 48.6745 193.336 48.8047C192.93 48.9349 192.539 49.0885 192.164 49.2656L191.57 47.9531C192.039 47.7083 192.552 47.5234 193.109 47.3984C193.667 47.2682 194.193 47.2031 194.688 47.2031C195.786 47.2031 196.615 47.4427 197.172 47.9219C197.734 48.401 198.016 49.1536 198.016 50.1797V56H196.703ZM193.969 54.75C194.635 54.75 195.169 54.5651 195.57 54.1953C195.977 53.8203 196.18 53.2969 196.18 52.625V51.875L195.07 51.9219C194.206 51.9531 193.576 52.099 193.18 52.3594C192.789 52.6146 192.594 53.0078 192.594 53.5391C192.594 53.9245 192.708 54.224 192.938 54.4375C193.167 54.6458 193.51 54.75 193.969 54.75ZM203.797 54.6719C204.245 54.6719 204.693 54.6016 205.141 54.4609V55.8438C204.938 55.9323 204.674 56.0052 204.352 56.0625C204.034 56.125 203.703 56.1562 203.359 56.1562C201.62 56.1562 200.75 55.2396 200.75 53.4062V48.75H199.57V47.9375L200.836 47.2656L201.461 45.4375H202.594V47.3594H205.055V48.75H202.594V53.375C202.594 53.8177 202.703 54.1458 202.922 54.3594C203.146 54.5677 203.438 54.6719 203.797 54.6719ZM208.711 56H206.875V47.3594H208.711V56ZM206.766 45.0703C206.766 44.7422 206.854 44.4896 207.031 44.3125C207.214 44.1354 207.471 44.0469 207.805 44.0469C208.128 44.0469 208.378 44.1354 208.555 44.3125C208.737 44.4896 208.828 44.7422 208.828 45.0703C208.828 45.3828 208.737 45.6302 208.555 45.8125C208.378 45.9896 208.128 46.0781 207.805 46.0781C207.471 46.0781 207.214 45.9896 207.031 45.8125C206.854 45.6302 206.766 45.3828 206.766 45.0703ZM219.008 51.6641C219.008 53.0755 218.646 54.1771 217.922 54.9688C217.198 55.7604 216.19 56.1562 214.898 56.1562C214.091 56.1562 213.378 55.974 212.758 55.6094C212.138 55.2448 211.661 54.7214 211.328 54.0391C210.995 53.3568 210.828 52.5651 210.828 51.6641C210.828 50.263 211.188 49.1693 211.906 48.3828C212.625 47.5964 213.638 47.2031 214.945 47.2031C216.195 47.2031 217.185 47.6068 217.914 48.4141C218.643 49.2161 219.008 50.2995 219.008 51.6641ZM212.719 51.6641C212.719 53.6589 213.456 54.6562 214.93 54.6562C216.388 54.6562 217.117 53.6589 217.117 51.6641C217.117 49.6901 216.383 48.7031 214.914 48.7031C214.143 48.7031 213.583 48.9583 213.234 49.4688C212.891 49.9792 212.719 50.7109 212.719 51.6641ZM228.727 56H226.883V50.6875C226.883 50.0208 226.747 49.5234 226.477 49.1953C226.211 48.8672 225.786 48.7031 225.203 48.7031C224.427 48.7031 223.859 48.9323 223.5 49.3906C223.141 49.849 222.961 50.6172 222.961 51.6953V56H221.125V47.3594H222.562L222.82 48.4922H222.914C223.174 48.0807 223.544 47.763 224.023 47.5391C224.503 47.3151 225.034 47.2031 225.617 47.2031C227.69 47.2031 228.727 48.2578 228.727 50.3672V56ZM237.086 53.5391C237.086 54.3828 236.779 55.0312 236.164 55.4844C235.549 55.9323 234.669 56.1562 233.523 56.1562C232.372 56.1562 231.448 55.9818 230.75 55.6328V54.0469C231.766 54.5156 232.711 54.75 233.586 54.75C234.716 54.75 235.281 54.4089 235.281 53.7266C235.281 53.5078 235.219 53.3255 235.094 53.1797C234.969 53.0339 234.763 52.8828 234.477 52.7266C234.19 52.5703 233.792 52.3932 233.281 52.1953C232.286 51.8099 231.612 51.4245 231.258 51.0391C230.909 50.6536 230.734 50.1536 230.734 49.5391C230.734 48.7995 231.031 48.2266 231.625 47.8203C232.224 47.4089 233.036 47.2031 234.062 47.2031C235.078 47.2031 236.039 47.4089 236.945 47.8203L236.352 49.2031C235.419 48.8177 234.635 48.625 234 48.625C233.031 48.625 232.547 48.901 232.547 49.4531C232.547 49.724 232.672 49.9531 232.922 50.1406C233.177 50.3281 233.729 50.5859 234.578 50.9141C235.292 51.1901 235.81 51.4427 236.133 51.6719C236.456 51.901 236.695 52.1667 236.852 52.4688C237.008 52.7656 237.086 53.1224 237.086 53.5391Z" fill="#2D2C2C"/>
        </svg>

        ${rulesNotForOwner.length !== 0 && `<g style="user-select: none; -ms-user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; color: #2D2C2C;">
          <line stroke-linecap="round" x1="15" y1="100" x2="80" y2="100" stroke-width="5" stroke="#ddd" />
          <text x="100" font-family="Segoe UI, Ubuntu, Sans-Serif" className="unselectable" y="105">${truncate(fullName, 26)} - ${percentForOwner}%</text>
        </g>`}

        ${rulesNotForOwner.map((r, i) => `<g>
          <line stroke-linecap="round" x1="32" y1="${100 + (i === rulesNotForOwner.length - 1 ? 20 : 22) * i}" x2="32" y2="${125 + (i === rulesNotForOwner.length - 1 ? 20 : 22) * i}" stroke-width="5" stroke="#ddd" />
          <line stroke-linecap="round" x1="32" y1="${120 + 20 * i}" x2="100" y2="${120 + 20 * i}" stroke-width="5" stroke="#ddd" />
          <g style="user-select: none; -ms-user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -webkit-touch-callout: none; color: #2D2C2C;"><text font-family="Segoe UI, Ubuntu, Sans-Serif" font-weight="300" className="unselectable" x="120" y="${125 + 20 * i}">${truncate(r.repo.replace(/(<([^>]+)>)/gi, ""), 24)} - ${r.percent}%</text></g>
        </g>`).join(" ")}
      </svg>
    `)
  }
}

